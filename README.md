# Malware Detector
A Random Forest Classifier that classifies a file as malicious or benign based on its PE Headers

## Dataset
Top 1000 PE Imports compiled by Angelo Oliviera (Dataset DOI: 10.21227/004e-v304, source: https://ieee-dataport.org/open-access/malware-analysis-datasets-top-1000-pe-imports).
Consists of 1001 features comprising of the fields of the PE Header, along with an additional label ("malware") denoting whether the PE header was malicious or benign. All features were int (0 or 1) except for the unique character field "hash", which had to be excluded from analysis.

## Feature Engineering
In order to improve the accuracy of the model, we had to remove any redundant features, such as to use the least number of features that would yield the best result. We ultimately used only 20 features, as described below:

1. OpenProcess - passes a process ID for an existing process, and returns a process handle for that process
2. LoadLibraryA - used to load specified module into the address space of the calling process
3. GetProcessHeap - used to retrieve a handle to the default heap of the calling process
4. ShellExecuteW - used to execute or perform an operation on a file.
5. VirtualFree - releases and decommits a region of pages within the virtual address space of the calling process
6. GetDC - retrieves a handle to a device context (DC) for the client area of a specified window or for the entire screen
7. IsDebuggerPresent - determines whether the calling process is being debugged by a user-mode debugger
8. malloc - allocates resources in memory
9. FindNextFileA - continues a file search from a previous call
10. free - used to free up space
11. GetAsyncKeyState - determines whether a key is up or down at the time the function is called
12. GetTickCount - retrieves the number of milliseconds that have elapsed since the system was started
13. exit - terminates process after cleanup
14. _cexit - Performs cleanup operations and returns without terminating the process
15. VirtualAlloc - reserves, commits, or changes the state of a region of pages in the virtual address space of the calling process
16. VirtualProtect - changes the protection on a region of committed pages in the virtual address space of the calling process
17. GetModuleHandleA - retrieves a module handle for the specified module
18. ExitProcess - Ends the calling process and all its threads
19. RegCloseKey - Closes a handle to the specified registry key
20. GetCurrentProcessId - Retrieves the process identifier of the calling process

## Classifier 
We used a **Random Forest Classifier**. To avoid overfitting, we tuned the following hyperparameters with RandomizedSearchCV and GridSearchCV:

1. bootstrap: method for sampling data points (with or without replacement) ('False' value denotes thar entire dataset used to make trees)
2. max_depth: max number of levels in each decision tree (More depth may lead to single leaf nodes in each tree, less depth may not be sufficient enough to capture the info)
3. max_features: max number of features considered for splitting a node
4. n_estimators: number of trees in the forest
5. min_samples_split: min number of data points placed in a node before the node is split (how many samples are needed to split the node)
6. min_samples_leaf: min number of data points allowed in a leaf node (helps smoothen the model)

## Model Evaluation
The model was evaluated on the following metrics:

1. Out of Bag Score
2. Accuracy (training, cross validation and test)
3. Confusion Matrix (cross validation and test)
4. Precision (cross validation and test)
5. Recall (cross validation and test)
6. F1 Score (cross validation and test)
